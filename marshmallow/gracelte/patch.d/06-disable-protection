#!/sbin/sh

. "$env"

print "Removing Samsung secure kernel info..."
rm /system/*info*

print "Disabling SELinux enforcement..."
setprop ro.build.selinux 1
setprop ro.build.selinux.enforce 0
setprop ro.boot.selinux permissive

print "Disabling Knox..."
rm -rf /system/app/SecurityLogAgent
setprop ro.config.knox 0
setprop ro.config.kap false
delprop ro.config.kap_default_on
setprop ro.securestorage.support false

print "Disabling TIMA..."
setprop ro.config.tima 0
setprop ro.config.rkp false
delprop ro.config.timaversion

print "Disabling HDCP enforcing..."
setprop wlan.wfd.hdcp disable

print "Adding private mode support..."
insert_after_last init.rc "import /init\\..*\\.rc" "import /init.privatemode.rc"

#print "Probably unnecessary"
#setprop ro.sec.fle.encryption false

print "Applying MobiCore/TUI service fix..."

cat <<EOF > "$tmp/keepmc"
00060308060501020000000000000000.tlbin
07060000000000000000000000000000.tlbin
08130000000000000000000000000000.tlbin
ffffffff000000000000000000000005.tlbin
ffffffff00000000000000000000000e.tlbin
ffffffff000000000000000000000016.tlbin
ffffffff000000000000000000000019.tlbin
ffffffff00000000000000000000001f.tlbin
ffffffff00000000000000000000002e.tlbin
ffffffff000000000000000000000042.tlbin
ffffffff000000000000000000000047.tlbin
ffffffffd00000000000000000000004.tlbin
ffffffffd0000000000000000000000e.tlbin
ffffffffd00000000000000000000014.tlbin
ffffffffd00000000000000000000016.tlbin
ffffffffd00000000000000000000017.tlbin
ffffffffd0000000000000000000001a.tlbin
EOF

cd /system/app/mcRegistry
for tlbin in *.tlbin; do
	grep -q "/^$tlbin\$/" "$tmp/keepmc" || rm "$tlbin"
done

rm -rf /system/app/TuiService

exit 0
